[README.md](https://github.com/user-attachments/files/24166030/README.md)

# MLflow + Optuna + PyTorch (Wine)

## Описание проекта

Этот проект показывает пример использования MLflow для управления экспериментами машинного обучения в сочетании с Optuna для автоматического подбора гиперпараметров. Проект решает задачу классификации на датасете Wine из scikit-learn с помощью полносвязной нейронной сети на PyTorch.

**Датасет:** `Wine` (`sklearn.datasets.load_wine`)
**Тип задачи:** Многоклассовая классификация (3 класса сортов вина)

## Структура проекта

**mlflow_optuna_project/**

`MLproject # Конфигурация MLflow-проекта`

`conda.yaml # Зависимости conda`

`train.py # Основной скрипт обучения и Optuna-оптимизации`

`README.md # Документация проекта`

## Зависимости

Проект использует следующие библиотеки:

- **Python 3.9**
- **mlflow** – управление экспериментами и логирование
- **scikit-learn** – загрузка датасета, разбиение и метрики
- **matplotlib** – построение графиков
- **optuna** – оптимизация гиперпараметров
- **torch** – реализация нейросети на PyTorch
- **numpy, pandas** – обработка данных

## Что делает проект

1. **Загружает датасет Wine** из scikit-learn, масштабирует признаки и делит данные на обучающую и тестовую выборки.
2. **Строит нейронную сеть** (`torch.nn.Sequential`) с настраиваемым числом слоев, размером скрытого слоя и dropout.
3. **Подбирает гиперпараметры через Optuna**:
   - `n_layers` (1-3 скрытых слоя)
   - `hidden_dim` (16-128, по логарифмической шкале)
   - `dropout` (0.0-0.5)
   - `lr` (1e-4 - 5e-2, по логарифмической шкале)
   - `batch_size` (8, 16, 32)
   - `epochs` (30-150)
4. **Логирует в MLflow**:
   - гиперпараметры и метрики каждого trial (child run),
   - график функции потерь (`loss_curve.png`),
   - confusion matrix (`confusion_matrix.png`),
   - сохранённую модель (`model.pt`).
5. **Создаёт родительский run `optuna_study`**, в который записываются:
   - датасет, тип задачи и seed,
   - лучшая метрика `best_accuracy` и лучшие гиперпараметры (`best_*`),
   - файл `summary.json` со сводкой по исследованию,
   - дубликаты графиков для лучшего trial в папке `best_plots/`.
6. **Обеспечивает воспроизводимость** за счёт фиксированных seed’ов и детерминированных настроек PyTorch.

## Как запустить

*Локальный запуск*

*Клонирование репозитория*

git clone [https://github.com/](https://github.com/)wlwwwlw/mlflow-optuna-project.git
cd mlflow-optuna-project

# Запуск проекта через MLflow

`mlflou`

### Запуск с GitHub

mlflow run [https://github.com/](https://github.com/)<ваш_логин>/mlflow-optuna-project

### Просмотр результатов

После завершения обучения запустите интерфейс MLflow: `mlflow ui`

Откройте в браузере `http://localhost:5000` и перейдите в эксперимент `mlflow-optuna-wine`.


Там будут видны:

родительский run `optuna_study` (лучшие параметры, `summary.json`, папка `best_plots`),

несколько дочерних run’ов `trial-*` с индивидуальными графиками и моделями.

## Воспроизводимость

Для `numpy`, `torch` и `random` использован фиксированный seed `42`, а также включtн детерминированный режим PyTorch.
Благодаря этому при запуске проекта локально и через GitHub лучшие гиперпараметры (`best_batch_size`, `best_dropout`, `best_epochs`, `best_hidden_dim`, `best_lr`, `best_n_layers`) и метрика `best_accuracy` совпадают, что демонстрирует полную воспроизводимость эксперимента.

## Результаты

Проект выполняет 20 trials Optuna и сохраняет:

- лучшие найденные гиперпараметры, например:
  - `best_batch_size = 8`
  - `best_dropout = 0.3`
  - `best_epochs ≈ 112`
  - `best_hidden_dim ≈ 126`
  - `best_lr ≈ 2.19e-4`
  - `best_n_layers = 2`
- кривую обучения (`Training loss`), которая показывает быстрое снижение ошибки до значений, близких к нулю;
- confusion matrix, где модель корректно классифицирует все объекты тестовой выборки (accuracy = 1.0);
- веса лучшей модели и сводку результатов в `summary.json`.

## Требования

- Python 3.9+
- Conda или Miniconda
- Git (для работы с GitHub)
- Возможность установить зависимости из `conda.yaml`
